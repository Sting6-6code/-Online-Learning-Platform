<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Student.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Online Learning Platform</a> &gt; <a href="index.source.html" class="el_package">com.olp.model.user</a> &gt; <span class="el_source">Student.java</span></div><h1>Student.java</h1><pre class="source lang-java linenums">package com.olp.model.user;

import java.util.*;
import java.sql.Date;
import javax.persistence.*;
import com.olp.model.course.Enrollment;
import com.olp.model.course.Course;
import com.olp.model.assignment.Submission;
import com.olp.model.assignment.Assignment;
import com.olp.model.assignment.Grade;

// line 18 &quot;model.ump&quot;
// line 230 &quot;model.ump&quot;
@Entity
@Table(name = &quot;students&quot;)
public class Student extends User
{

  //------------------------
  // ENUMERATIONS
  //------------------------
  // Note: EnrollmentStatus is defined in Enrollment class

  //------------------------
  // MEMBER VARIABLES
  //------------------------

  //Student Associations
  @OneToMany(mappedBy = &quot;student&quot;, cascade = CascadeType.ALL, orphanRemoval = true)
  private List&lt;Enrollment&gt; studentEnrollments;
  
  @OneToMany(mappedBy = &quot;student&quot;, cascade = CascadeType.ALL, orphanRemoval = true)
  private List&lt;Submission&gt; studentSubmissions;

  //------------------------
  // CONSTRUCTOR
  //------------------------

  /**
   * Protected no-argument constructor for JPA
   */
  protected Student()
  {
<span class="nc" id="L44">    super();</span>
<span class="nc" id="L45">    studentEnrollments = new ArrayList&lt;Enrollment&gt;();</span>
<span class="nc" id="L46">    studentSubmissions = new ArrayList&lt;Submission&gt;();</span>
<span class="nc" id="L47">  }</span>

  public Student(String aId, String aName, String aEmail)
  {
<span class="fc" id="L51">    super(aId, aName, aEmail);</span>
<span class="fc" id="L52">    studentEnrollments = new ArrayList&lt;Enrollment&gt;();</span>
<span class="fc" id="L53">    studentSubmissions = new ArrayList&lt;Submission&gt;();</span>
<span class="fc" id="L54">  }</span>

  //------------------------
  // INTERFACE
  //------------------------
  /* Code from template association_GetMany */
  public Enrollment getStudentEnrollment(int index)
  {
<span class="fc" id="L62">    Enrollment aStudentEnrollment = studentEnrollments.get(index);</span>
<span class="fc" id="L63">    return aStudentEnrollment;</span>
  }

  public List&lt;Enrollment&gt; getStudentEnrollments()
  {
<span class="nc" id="L68">    List&lt;Enrollment&gt; newStudentEnrollments = Collections.unmodifiableList(studentEnrollments);</span>
<span class="nc" id="L69">    return newStudentEnrollments;</span>
  }

  public int numberOfStudentEnrollments()
  {
<span class="fc" id="L74">    int number = studentEnrollments.size();</span>
<span class="fc" id="L75">    return number;</span>
  }

  public boolean hasStudentEnrollments()
  {
<span class="fc bfc" id="L80" title="All 2 branches covered.">    boolean has = studentEnrollments.size() &gt; 0;</span>
<span class="fc" id="L81">    return has;</span>
  }

  public int indexOfStudentEnrollment(Enrollment aStudentEnrollment)
  {
<span class="nc" id="L86">    int index = studentEnrollments.indexOf(aStudentEnrollment);</span>
<span class="nc" id="L87">    return index;</span>
  }
  /* Code from template association_GetMany */
  public Submission getStudentSubmission(int index)
  {
<span class="fc" id="L92">    Submission aStudentSubmission = studentSubmissions.get(index);</span>
<span class="fc" id="L93">    return aStudentSubmission;</span>
  }

  public List&lt;Submission&gt; getStudentSubmissions()
  {
<span class="nc" id="L98">    List&lt;Submission&gt; newStudentSubmissions = Collections.unmodifiableList(studentSubmissions);</span>
<span class="nc" id="L99">    return newStudentSubmissions;</span>
  }

  public int numberOfStudentSubmissions()
  {
<span class="fc" id="L104">    int number = studentSubmissions.size();</span>
<span class="fc" id="L105">    return number;</span>
  }

  public boolean hasStudentSubmissions()
  {
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">    boolean has = studentSubmissions.size() &gt; 0;</span>
<span class="fc" id="L111">    return has;</span>
  }

  public int indexOfStudentSubmission(Submission aStudentSubmission)
  {
<span class="nc" id="L116">    int index = studentSubmissions.indexOf(aStudentSubmission);</span>
<span class="nc" id="L117">    return index;</span>
  }
  /* Code from template association_MinimumNumberOfMethod */
  public static int minimumNumberOfStudentEnrollments()
  {
<span class="nc" id="L122">    return 0;</span>
  }
  /* Code from template association_AddManyToOne */
  public Enrollment addStudentEnrollment(String aId, Enrollment.EnrollmentStatus aStatus, Date aEnrolledAt, Course aCourse)
  {
<span class="nc" id="L127">    return new Enrollment(aId, aStatus, aEnrolledAt, this, aCourse);</span>
  }

  public boolean addStudentEnrollment(Enrollment aStudentEnrollment)
  {
<span class="fc" id="L132">    boolean wasAdded = false;</span>
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">    if (studentEnrollments.contains(aStudentEnrollment)) { return false; }</span>
<span class="fc" id="L134">    Student existingStudent = aStudentEnrollment.getStudent();</span>
<span class="pc bpc" id="L135" title="2 of 4 branches missed.">    boolean isNewStudent = existingStudent != null &amp;&amp; !this.equals(existingStudent);</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">    if (isNewStudent)</span>
    {
<span class="nc" id="L138">      aStudentEnrollment.setStudent(this);</span>
    }
    else
    {
<span class="fc" id="L142">      studentEnrollments.add(aStudentEnrollment);</span>
    }
<span class="fc" id="L144">    wasAdded = true;</span>
<span class="fc" id="L145">    return wasAdded;</span>
  }

  public boolean removeStudentEnrollment(Enrollment aStudentEnrollment)
  {
<span class="fc" id="L150">    boolean wasRemoved = false;</span>
    //Unable to remove aStudentEnrollment, as it must always have a student
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">    if (!this.equals(aStudentEnrollment.getStudent()))</span>
    {
<span class="fc" id="L154">      studentEnrollments.remove(aStudentEnrollment);</span>
<span class="fc" id="L155">      wasRemoved = true;</span>
    }
<span class="fc" id="L157">    return wasRemoved;</span>
  }
  /* Code from template association_AddIndexControlFunctions */
  public boolean addStudentEnrollmentAt(Enrollment aStudentEnrollment, int index)
  {  
<span class="nc" id="L162">    boolean wasAdded = false;</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">    if(addStudentEnrollment(aStudentEnrollment))</span>
    {
<span class="nc bnc" id="L165" title="All 2 branches missed.">      if(index &lt; 0 ) { index = 0; }</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">      if(index &gt; numberOfStudentEnrollments()) { index = numberOfStudentEnrollments() - 1; }</span>
<span class="nc" id="L167">      studentEnrollments.remove(aStudentEnrollment);</span>
<span class="nc" id="L168">      studentEnrollments.add(index, aStudentEnrollment);</span>
<span class="nc" id="L169">      wasAdded = true;</span>
    }
<span class="nc" id="L171">    return wasAdded;</span>
  }

  public boolean addOrMoveStudentEnrollmentAt(Enrollment aStudentEnrollment, int index)
  {
<span class="nc" id="L176">    boolean wasAdded = false;</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">    if(studentEnrollments.contains(aStudentEnrollment))</span>
    {
<span class="nc bnc" id="L179" title="All 2 branches missed.">      if(index &lt; 0 ) { index = 0; }</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">      if(index &gt; numberOfStudentEnrollments()) { index = numberOfStudentEnrollments() - 1; }</span>
<span class="nc" id="L181">      studentEnrollments.remove(aStudentEnrollment);</span>
<span class="nc" id="L182">      studentEnrollments.add(index, aStudentEnrollment);</span>
<span class="nc" id="L183">      wasAdded = true;</span>
    } 
    else 
    {
<span class="nc" id="L187">      wasAdded = addStudentEnrollmentAt(aStudentEnrollment, index);</span>
    }
<span class="nc" id="L189">    return wasAdded;</span>
  }
  /* Code from template association_MinimumNumberOfMethod */
  public static int minimumNumberOfStudentSubmissions()
  {
<span class="nc" id="L194">    return 0;</span>
  }
  /* Code from template association_AddManyToOne */
  public Submission addStudentSubmission(String aId, Date aSubmittedAt, int aVersion, boolean aCheckPassed, Grade aSubmissionGrade, Assignment aAssignment)
  {
<span class="nc" id="L199">    return new Submission(aId, aSubmittedAt, aVersion, aCheckPassed, aSubmissionGrade, this, aAssignment);</span>
  }

  public boolean addStudentSubmission(Submission aStudentSubmission)
  {
<span class="fc" id="L204">    boolean wasAdded = false;</span>
<span class="pc bpc" id="L205" title="1 of 2 branches missed.">    if (studentSubmissions.contains(aStudentSubmission)) { return false; }</span>
<span class="fc" id="L206">    Student existingStudent = aStudentSubmission.getStudent();</span>
<span class="pc bpc" id="L207" title="2 of 4 branches missed.">    boolean isNewStudent = existingStudent != null &amp;&amp; !this.equals(existingStudent);</span>
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">    if (isNewStudent)</span>
    {
<span class="nc" id="L210">      aStudentSubmission.setStudent(this);</span>
    }
    else
    {
<span class="fc" id="L214">      studentSubmissions.add(aStudentSubmission);</span>
    }
<span class="fc" id="L216">    wasAdded = true;</span>
<span class="fc" id="L217">    return wasAdded;</span>
  }

  public boolean removeStudentSubmission(Submission aStudentSubmission)
  {
<span class="nc" id="L222">    boolean wasRemoved = false;</span>
    //Unable to remove aStudentSubmission, as it must always have a student
<span class="nc bnc" id="L224" title="All 2 branches missed.">    if (!this.equals(aStudentSubmission.getStudent()))</span>
    {
<span class="nc" id="L226">      studentSubmissions.remove(aStudentSubmission);</span>
<span class="nc" id="L227">      wasRemoved = true;</span>
    }
<span class="nc" id="L229">    return wasRemoved;</span>
  }
  /* Code from template association_AddIndexControlFunctions */
  public boolean addStudentSubmissionAt(Submission aStudentSubmission, int index)
  {  
<span class="nc" id="L234">    boolean wasAdded = false;</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">    if(addStudentSubmission(aStudentSubmission))</span>
    {
<span class="nc bnc" id="L237" title="All 2 branches missed.">      if(index &lt; 0 ) { index = 0; }</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">      if(index &gt; numberOfStudentSubmissions()) { index = numberOfStudentSubmissions() - 1; }</span>
<span class="nc" id="L239">      studentSubmissions.remove(aStudentSubmission);</span>
<span class="nc" id="L240">      studentSubmissions.add(index, aStudentSubmission);</span>
<span class="nc" id="L241">      wasAdded = true;</span>
    }
<span class="nc" id="L243">    return wasAdded;</span>
  }

  public boolean addOrMoveStudentSubmissionAt(Submission aStudentSubmission, int index)
  {
<span class="nc" id="L248">    boolean wasAdded = false;</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">    if(studentSubmissions.contains(aStudentSubmission))</span>
    {
<span class="nc bnc" id="L251" title="All 2 branches missed.">      if(index &lt; 0 ) { index = 0; }</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">      if(index &gt; numberOfStudentSubmissions()) { index = numberOfStudentSubmissions() - 1; }</span>
<span class="nc" id="L253">      studentSubmissions.remove(aStudentSubmission);</span>
<span class="nc" id="L254">      studentSubmissions.add(index, aStudentSubmission);</span>
<span class="nc" id="L255">      wasAdded = true;</span>
    } 
    else 
    {
<span class="nc" id="L259">      wasAdded = addStudentSubmissionAt(aStudentSubmission, index);</span>
    }
<span class="nc" id="L261">    return wasAdded;</span>
  }

  //------------------------
  // Convenience Methods (Task 1.2)
  //------------------------
  
  /**
   * 统计 Active 状态的 Enrollment 数量
   * Task 1.2: 添加便捷方法
   */
  public int getActiveEnrollmentCount()
  {
<span class="fc" id="L274">    int count = 0;</span>
<span class="fc bfc" id="L275" title="All 2 branches covered.">    for (Enrollment enrollment : studentEnrollments) {</span>
<span class="fc bfc" id="L276" title="All 2 branches covered.">      if (enrollment.getStatus() == Enrollment.EnrollmentStatus.Active) {</span>
<span class="fc" id="L277">        count++;</span>
      }
<span class="fc" id="L279">    }</span>
<span class="fc" id="L280">    return count;</span>
  }

  public void delete()
  {
<span class="nc bnc" id="L285" title="All 2 branches missed.">    for(int i=studentEnrollments.size(); i &gt; 0; i--)</span>
    {
<span class="nc" id="L287">      Enrollment aStudentEnrollment = studentEnrollments.get(i - 1);</span>
<span class="nc" id="L288">      aStudentEnrollment.delete();</span>
    }
<span class="nc bnc" id="L290" title="All 2 branches missed.">    for(int i=studentSubmissions.size(); i &gt; 0; i--)</span>
    {
<span class="nc" id="L292">      Submission aStudentSubmission = studentSubmissions.get(i - 1);</span>
<span class="nc" id="L293">      aStudentSubmission.delete();</span>
    }
<span class="nc" id="L295">    super.delete();</span>
<span class="nc" id="L296">  }</span>

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>